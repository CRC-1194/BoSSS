<?xml version="1.0" encoding="utf-8"?>
<!--  BoSSS control file, specialized for the compressible Navier-Stokes solver:
      Soure Terms for a manufactured solution based on Masa Library: "Malaya, 
      Nicholas, et al. "MASA: a library for verification using manufactured 
      and analytical solutions." Engineering with Computers 29.4 (2013): 487-496."-->
<BoSSSControl>
	<Base>
		<dboptions path="c:\bosss_dbv2\exp\" />
		<!-- no grid-->
    <grid guid="00000000-0000-0000-0000-000000000016" />
    
    <!-- h = 1/16
    <grid guid="b8ed032c-3fb4-427a-9bdd-ed35ede16a48" />-->


    <description name="MASA1d_CNS-subsonic_h=1/16_p=1">
			viscous NSE Test -> MMS subsonic
		</description>
		
		<tags>
			viscous, CNS, MMS
		</tags>
    <!-- Specify "solver" or "query" or "parameterStudy" -->
		<run mode="solver"/>
    
		<fields_degree>
			<!-- Specify DG polynomial degree; If degree for "u", "e", "p",
								"T", "Ma", "K" or "S" are given, these fields will also be
								calculated and included in IO operations -->
			<field	identification="rho"	degree="1" />
			<field	identification="m"		degree="1" />
			<field	identification="rhoE"	degree="1" />
      <field  identification="u" degree="1"/>
      <field  identification="p" degree="1"/>
      <field  identification="T" degree="1"/>
      <field  identification="Ma" degree="1"/>
		</fields_degree>
	</Base>

	<!-- Specify "values" or "restart" -->
	<initial mode="values">

		<restart>
			<session guid="969eb288-1c19-4cbc-bdf7-f8edc8d8da3b" timestepno="" />
		</restart>

		<values>
			<formula>
        rho(x) = (0.5 + 0.25 * sin(2*PI*x))
      </formula>
			<formula>
        m0(x) = (0.5 + 0.25 * sin(2*PI*x))^2
      </formula>
			<formula>
        rhoE(x) = (0.5 + 0.25 * cos(2*PI*x))/(1.4-1) + 0.5 * (0.5 + 0.25 * sin(2*PI*x))^3
      </formula>
		</values>
	</initial>

	<Solver>
		<logging savetodb="true" saveperiod="10000" tracing="false"/>
		<termcond Endtime="3." NoOfTimesteps="10000000"/>
		<timestepping dtMin="0.e-7" dtMax="1.e-4" CFLFrac=".05"/>
		<!--<timestepping dtMin="4.82e-6" dtMax="4.82e-6" CFLFrac="0.01"/>-->

		<boundary>
			<bc edgetagname="subsonicinlet">
				<formula>
          rho(x) = 0.5
        </formula>
				<formula>
          u0(x) = 0.5
        </formula>
			</bc>
      <bc edgetagname="supersonicinlet">
        <formula>
          rho(x) = 0.5
        </formula>
        <formula>
          u0(x) = 0.5
        </formula>
        <formula>
          p(x) = 0.75
        </formula>
      </bc>
			<bc edgetagname="subsonicoutlet">
        <formula>
          p(x) = 0.75
        </formula>
			</bc>

		</boundary>
		<properties>
		
			<string key="equationSystem">NavierStokes</string>
			<string key="convectiveFluxType">HLLC</string>
			
			<string key="diffusiveFluxType">SIPG</string>			
			<float key="SIPGPenaltyConstant">1.3</float> 

			<string key="timeStepping">explicit</string>
			<string key="explicitScheme">RungeKutta</string>
        <int key="explicitOrder">1</int>

      <!--<float key="Reynolds">5.5613479</float>-->
      <float key="Reynolds">1.0</float>
			<float key="Mach">1.0</float>
			<float key="Prandtl">1</float>
			<float key="kappa">1.4</float>
			<!-- Choose "IdealGas", "Tait" or "StiffenedGas". Omitting this
								 option will make CNS default to "IdealGas".-->
			<string key="equationOfState">IdealGas</string>
			<!-- "None": No residual calculation;
								 "SteadyState": Residuals for a steady state problem;
								 "Unsteady": Residuals for an unsteady problem -->
			<string key="residualType">ChangeRate,query</string>
			<int key="residualInterval">1000</int>
      <!-- Interval for 'Starting time step' statements (they can affect
								 serial and parallel performance of individual time-steps are
								 fast!). -->
      <int key="printInterval">1000</int>
			<!-- The following properties represent optional formulas defining 
								 source terms of the selected equation system. Each formula may
								 depend on independent variables as well as primal fields -->
			<string key="rhoSource">
        f(x)  = - 2*PI*0.25*(0.5 + 0.25 * sin(2*PI*x)) * cos(2*PI*x)
                - 2*PI*0.25*(0.5 + 0.25 * sin(2*PI*x)) * cos(2*PI*x)
      </string>
			<string key="m0Source">
        f(x)  =- 2*PI*0.25*(0.5 + 0.25 * sin(2*PI*x))^2 *cos(2*PI*x)
        + 2*PI*0.25*sin(2*PI*x)
        - 2*2*PI*0.25*(0.5 + 0.25 * sin(2*PI*x))*(0.5 + 0.25 * sin(2*PI*x)) *cos(2*PI*x)
        - 4/3*2^2*PI^2*0.25*1*sin(2*PI*x)
      </string>
			<string key="rhoESource">
        f(x) =- 1/2*2*PI*0.25*(0.5 + 0.25 * sin(2*PI*x))^3*cos(2*PI*x)
        +1.4/0.4*2*PI*0.25*(0.5 + 0.25 * sin(2*PI*x))*sin(2*PI*x)
        -1.4/0.4*2*PI*0.25*(0.5 + 0.25 * cos(2*PI*x))*cos(2*PI*x)
        -3/2*2*PI*0.25*(0.5 + 0.25 * sin(2*PI*x))*(0.5 + 0.25 * sin(2*PI*x))^2 * cos(2*PI*x)
        +1.4/(1.4-1)*2*2^2*PI^2*0.25^2*(0.5 + 0.25* cos(2*PI*x))/(0.5 + 0.25 * sin(2*PI*x))^3 *cos(2*PI*x)^2
        +1.4/(1.4-1)*2*2*2*PI^2*0.25*0.25/(0.5 + 0.25 * sin(2*PI*x))^2 *cos(2*PI*x)*sin(2*PI*x)
        +1.4/(1.4-1)*2^2*PI^2*0.25*(0.5 + 0.25*cos(2*PI*x))/(0.5 + 0.25 * sin(2*PI*x))^2 *sin(2*PI*x)
        -1.4/(1.4-1)*2^2*PI^2*0.25/(0.5 + 0.25 * sin(2*PI*x)) *cos(2*PI*x)
        +4/3*2^2*PI^2*0.25^2 *cos(2*PI*x)^2
        -4/3*2^2*PI^2*0.25*(0.5 + 0.25 * sin(2*PI*x)) *sin(2*PI*x)

      </string>
			<!-- Choose "Symbolic" or "byFlux" for the calculation of the
								 derivatives of the primal variables -->
			<string key="derivativeOption">None</string>
		</properties>

   
    <Queries>
			<L2Error id="SolL2Err_rho">
				<computedSolution>
					<field identification="rho" />
				</computedSolution>
				<exactSolution>
          <formula degree="10">
            rho(x) = 0.5 + 0.25*sin(2*PI*x)
          </formula>
				</exactSolution>
			</L2Error>
      <L2Error id="SolL2Err_m0">
        <computedSolution>
          <field identification="m0" />
        </computedSolution>
        <exactSolution>
          <formula degree="10">
            m0(x) = (0.5 + 0.25* sin(2*PI*x))*(0.5 + 0.25* sin(2*PI*x))
          </formula>
        </exactSolution>
      </L2Error>
      <L2Error id="SolL2Err_rhoE">
        <computedSolution>
          <field identification="rhoE" />
        </computedSolution>
        <exactSolution>
          <formula degree="10">
            rhoE(x) = (0.5 + 0.25* cos(2*PI*x))/(1.4-1) + (0.5 + 0.25* sin(2*PI*x))^3 /2
          </formula>
        </exactSolution>
      </L2Error>
      <L2Error id="SolL2Err_U0">
        <computedSolution>
          <field identification="u0" />
        </computedSolution>
        <exactSolution>
          <formula degree="10">
            p(x) = 0.5 + 0.25 * sin(2*PI*x)
          </formula>
        </exactSolution>
      </L2Error>
		</Queries>
	</Solver>
  <ParameterStudy logFileDirectory=".">
    <parameterSet>
      <parameter id="grid" xpath="Base/grid/@guid">
        00000000-0000-0000-0000-000000000016
        00000000-0000-0000-0000-000000000032
        00000000-0000-0000-0000-000000000064
      </parameter>
      <parameter id="description" xpath="Base/description/@name">
        MASA1d_CNS-subsonic_h=1/16_p=x
        MASA1d_CNS-subsonic_h=1/32_p=x
        MASA1d_CNS-subsonic_h=1/64_p=x
      </parameter>
    </parameterSet>
    <parameterSet>
      <parameter id="rho-degree" xpath="Base/fields_degree/field[@identification='rho']/@degree">1 2 3</parameter>
      <parameter id="m-degree" xpath="Base/fields_degree/field[@identification='m']/@degree">1 2 3</parameter>
      <parameter id="rhoE-degree" xpath="Base/fields_degree/field[@identification='rhoE']/@degree">1 2 3</parameter>
      <parameter id="u-degree" xpath="Base/fields_degree/field[@identification='u']/@degree">1 2 3</parameter>
    </parameterSet>
  </ParameterStudy>
</BoSSSControl>
